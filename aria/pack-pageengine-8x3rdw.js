/*
 * Copyright 2009-2014 Amadeus s.a.s.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//***MULTI-PART
//*******************
//LOGICAL-PATH:aria/pageEngine/CfgBeans.js
//*******************
var e=require("../Aria"),t=require("../core/JsonTypes"),i=require("../core/CfgBeans"),r=require("../templates/CfgBeans"),a=require("../utils/css/AnimationsBean");module.exports=e.beanDefinitions({$package:"aria.pageEngine.CfgBeans",$namespaces:{json:t,core:i,template:r,animation:a},$beans:{ExtendedCallback:{$type:"json:Object",$properties:{onsuccess:{$type:"core:Callback"},onfailure:{$type:"core:Callback"}}},Start:{$type:"json:Object",$properties:{pageProvider:{$type:"json:Object",$mandatory:!0},onerror:{$type:"core:Callback"},oncomplete:{$type:"core:Callback"},rootModule:{$type:"template:InitModuleCtrl"}}},Site:{$type:"json:Object",$restricted:!1,$properties:{containerId:{$type:"json:String",$mandatory:!0},commonModules:{$type:"json:Map",$contentType:{$type:"CommonModule"},$default:{}},appData:{$type:"json:Map",$contentType:{$type:"json:MultiTypes"},$default:{}},contentProcessors:{$type:"json:Map",$contentType:{$type:"json:PackageName"},$default:{}},navigation:{$type:"json:Enum",$enumValues:["history","hash"]},storage:{$type:"json:Object",$properties:{active:{$type:"json:Boolean",$default:!0},suffix:{$type:"json:String",$default:""},expiresAfter:{$type:"json:Integer",$default:86400}},$default:{active:!0,suffix:"",expiresAfter:86400}},animations:{$type:"json:Boolean",$default:!1},css:{$type:"json:Array",$contentType:{$type:"json:String"}}}},PageRequest:{$type:"json:Object",$restricted:!1,$properties:{pageId:{$type:"json:String"},url:{$type:"json:String"}}},PageNavigationInformation:{$type:"PageRequest",$restricted:!1,$properties:{replace:{$type:"json:Boolean"},title:{$type:"json:String"},data:{$type:"json:Object"},forceReload:{$type:"json:Boolean"}}},PageDefinition:{$type:"json:Object",$restricted:!1,$properties:{contents:{$type:"PageContents",$default:{}},pageComposition:{$type:"PageComposition",$mandatory:!0},pageId:{$type:"json:String",$mandatory:!0},url:{$type:"json:String"},title:{$type:"json:String"},animation:{$type:"PageAnimation"}}},PageContents:{$type:"json:Object",$properties:{menus:{$type:"json:Map",$keyType:{$type:"json:String"},$contentType:{$type:"json:Object",$restricted:!1}},placeholderContents:{$type:"json:Map",$keyType:{$type:"json:String"},$contentType:{$type:"json:MultiTypes",$contentTypes:[{$type:"Content"},{$type:"json:Array",$contentType:{$type:"Content"}}]}}}},PageComposition:{$type:"json:Object",$properties:{template:{$type:"json:String",$mandatory:!0},pageData:{$type:"json:Object",$restricted:!1,$default:{}},modules:{$type:"json:Map",$contentType:{$type:"Module"},$default:{}},placeholders:{$type:"json:Map",$keyType:{$type:"json:String",$sample:"body.top"},$contentType:{$type:"Placeholder"},$mandatory:!0},css:{$type:"json:Array",$contentType:{$type:"json:String"}}}},PageAnimation:{$type:"json:Object",$properties:{animateOut:{$type:"animation:AnimationName",$sample:"slide left"},animateIn:{$type:"animation:AnimationName",$sample:"slide left",$mandatory:!0},type:{$type:"json:Integer"}}},Placeholder:{$type:"json:MultiTypes",$contentTypes:[{$type:"json:String"},{$type:"json:Object",$properties:{template:{$type:"json:String"},contentId:{$type:"json:String"},module:{$type:"json:String"},data:{$type:"json:Object"},args:{$type:"json:Array",$contentType:{$type:"json:MultiTypes"}},css:{$type:"json:Array",$contentType:{$type:"json:String"}}}},{$type:"json:Array",$contentType:{$type:"Placeholder"}}]},Module:{$type:"json:Object",$properties:{classpath:{$type:"json:PackageName",$mandatory:!0},initArgs:{$type:"json:ObjectRef"},bind:{$type:"json:ObjectRef"},services:{$type:"json:Map",$keyType:{$type:"json:String"},$contentType:{$type:"json:String"},$default:{}}}},CommonModule:{$type:"Module",$properties:{priority:{$type:"json:Integer",$default:1,$minValue:1,$maxValue:2}}},Content:{$type:"json:Object",$properties:{value:{$type:"json:String",$mandatory:!0},contentType:{$type:"json:String"}}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/PageEngineInterface.js
//*******************
var e=require("../Aria");module.exports=e.interfaceDefinition({$classpath:"aria.pageEngine.PageEngineInterface",$events:{pageReady:"",beforePageTransition:""},$interface:{navigate:{$type:"Function",$callbackParam:1},getData:{$type:"Function"},getServices:{$type:"Function"},getPageProvider:{$type:"Function"},isModuleInPage:{$type:"Function"}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/SiteRootModuleInterface.js
//*******************
var e=require("../Aria"),t=require("../templates/IModuleCtrl");module.exports=e.interfaceDefinition({$classpath:"aria.pageEngine.SiteRootModuleInterface",$extends:t,$events:{pageReady:""},$interface:{getPageModule:{$type:"Function"},loadModules:{$type:"Function",$callbackParam:2},unloadCommonModules:{$type:"Function"},unloadPageModules:{$type:"Function"},unloadAllModules:{$type:"Function"},navigate:{$type:"Function"}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/PageEngineUtils.js
//*******************
var e=require("../../Aria"),t=require("../../utils/Array"),i=require("../../utils/Path");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.PageEngineUtils",$singleton:!0,$prototype:{addIfMissing:function(e,i){e&&!t.contains(i,e)&&i.push(e)},wiseConcat:function(e,t){for(var i,r=0,a=t.length;a>r;r++)i=t[r],this.addIfMissing(i,e)},extractPropertyFromArrayElements:function(e,t){for(var i,r=[],a=0,s=e.length;s>a;a++)i=e[a],i[t]&&r.push(i[t]);return r},addKeyAsProperty:function(e,t){for(var i in e)e.hasOwnProperty(i)&&(e[i][t]=i)},resolvePath:function(e,t){var r;try{r=i.resolve(e,t)}catch(a){r=void 0}return r},logMultipleErrors:function(e,t,i){i.$logError.apply(i,[e+":"]);for(var r=0,a=t.length;a>r;r++)i.$logError.apply(i,[r+1+" - "+t[r].msgId,t[r].msgArgs])}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/SiteRootModule.js
//*******************
var e=require("../Aria"),t=require("./SiteRootModuleInterface"),i=require("../utils/Path"),r=require("./utils/PageEngineUtils"),a=require("../utils/Function"),s=require("../templates/ModuleCtrl"),n=require("../utils/Type"),o=require("../utils/Json");module.exports=e.classDefinition({$classpath:"aria.pageEngine.SiteRootModule",$extends:s,$implements:[t],$constructor:function(){this.$ModuleCtrl.constructor.call(this),this.commonModules={},this.pageModules={},this._modulesPaths={common:[],page:{}},this._utils=r,this._pathUtils=i,this._bindings={},this._pageEngine=null,this.services={},this._serviceList={}},$destructor:function(){this.json.removeListener(this._data,"storage",{fn:this._updateModulesData,scope:this},!0),this.unloadAllModules(),this._data=null,this.commonModules=null,this.pageModules=null,this.services=null,this.$ModuleCtrl.$destructor.call(this)},$statics:{SERVICE_METHOD_NOT_FOUND:"Cannot expose module controller method as a service, the method '%1' is not declared in module '%2' public interface",SERVICE_ALREADY_DEFINED:"A service called '%1' already exists"},$prototype:{$publicInterfaceName:"aria.pageEngine.SiteRootModuleInterface",init:function(e,t){this._data={storage:{appData:e.appData,pageData:{}}},this.json.addListener(this._data,"storage",{fn:this._updateModulesData,scope:this},!1,!0),this._pageEngine=e.pageEngine,this.$callback(t)},onSubModuleEvent:function(e){"navigate"==e.name&&this._pageEngine.navigate(e.page)},navigate:function(e,t){this._pageEngine.navigate(e,t)},getPageModule:function(e,t){var i=-1!=t.indexOf("common:"),r=this.buildModuleRefpath(t.replace(/^common:/,""),i,e);return this._utils.resolvePath(r,this)},buildModuleRefpath:function(e,t,i){return t?"commonModules."+e:"pageModules."+i+"."+e},loadModules:function(e,t,i){for(var r,a,s,n,l=[],c=[],u=[{modules:t.page,isCommon:!1},{modules:t.common,isCommon:!0}],h=0;2>h;h++){r=u[h].modules,s=u[h].isCommon;for(var p=0,d=r.length;d>p;p+=1)a=this.buildModuleRefpath(r[p].refpath,s,e),null==this._utils.resolvePath(a,this)&&(n=o.copy(r[p]),n.refpath=a,l.push({classpath:n.classpath,initArgs:this._injectPageEngine(n.initArgs),refpath:a}),c.push(n),this._addRefpath(e,s,a))}this.loadSubModules(l,{fn:this.createServices,scope:this,resIndex:-1,args:{pageId:e,callback:i,modules:c}})},createServices:function(e){for(var t=e.modules,i=0;i<t.length;i+=1){var r=t[i].services,s=t[i].refpath,o=this._utils.resolvePath(s,this);if(r)for(var l in r)r.hasOwnProperty(l)&&!this.json.isMetadata(l)&&(this.services[l]&&this.$logWarn(this.SERVICE_ALREADY_DEFINED,l),n.isFunction(o[r[l]])?(this.services[l]=a.bind(o[r[l]],o),this._serviceList[s]?this._serviceList[s].push(l):this._serviceList[s]=[l]):this.$logError(this.SERVICE_METHOD_NOT_FOUND,[r[l],o.$classpath]))}this.connectBindings(e)},_injectPageEngine:function(e){return e=e||{},e.pageEngine=this._pageEngine,e},_unloadModules:function(e){for(var t,i=0,r=e.length;r>i;i++)if(t=e[i],this._disconnectModuleBindings(t),this.disposeSubModule(this._utils.resolvePath(t,this)),this._serviceList[t]){for(var i=0;i<this._serviceList[t].length;i++)delete this.services[this._serviceList[t][i]];delete this._serviceList[t]}},unloadCommonModules:function(){var e=this._modulesPaths.common||[];this._unloadModules(e),this._modulesPaths.common=[]},unloadPageModules:function(e){var t=e&&this._modulesPaths.page[e]?this._modulesPaths.page[e]:[];this._unloadModules(t),delete this._modulesPaths.page[e]},unloadAllModules:function(){this.unloadCommonModules();var e=this._modulesPaths.page;for(var t in e)e.hasOwnProperty(t)&&this.unloadPageModules(t)},_addRefpath:function(e,t,i){var r=this._modulesPaths;return t?void r.common.push(i):(r.page[e]=r.page[e]||[],void r.page[e].push(i))},connectBindings:function(e){for(var t=e.modules,i=0;i<t.length;i+=1){var r=t[i].bind,a=t[i].refpath;if(r)for(var s in r)if(r.hasOwnProperty(s)&&!this.json.isMetadata(s)){var n=this._getStorage(r[s]);if(n){var o=this._getModuleDataDescription(a,s);this.$assert(2,!!o);var l={fn:this._bindModuleChange,scope:this,args:{boundTo:n,moduleDescription:o}};this.json.addListener(o.container,o.property,l,!1,!0),this._bindings[a]=this._bindings[a]||{},this._bindings[a][s]=[r[s],l]}}}this._updateModulesData(),this.$callback(e.callback,e.callback.args)},disconnectBindings:function(e){if(e)for(var t=0,i=e.length;i>t;t++)this._disconnectModuleBindings(e[t]);else{this.disconnectBindings(this._modulesPaths.common);var r=this._modulesPaths.page;for(var a in r)r.hasOwnProperty(a)&&this.disconnectBindings(r[a])}},_disconnectModuleBindings:function(e){var t=this._bindings[e];if(t){for(var i in t)if(t.hasOwnProperty(i)){var r=this._getModuleDataDescription(e,i);this.json.removeListener(r.container,r.property,t[i][1],!0)}delete this._bindings[e]}},_updateModulesData:function(){var e=this._bindings;for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];for(var r in i)if(i.hasOwnProperty(r)){var a=this._getModuleDataDescription(t,r),s=this._getStorage(i[r][0]),n=this._utils.resolvePath(s.path,s.storage);this.json.setValue(a.container,a.property,n,i[r][1])}}},_getModuleDataDescription:function(e,t){var i=this._utils.resolvePath(e,this._data);return this._utils.resolvePath(t,i)||this._pathUtils.setValue(i,t,null),this._pathUtils.describe(i,t)},_getStorage:function(e){var t=e.split(":");if(t.length<2)return null;var i=this._data.storage[t[0]];return i?(t.splice(0,1),{storage:i,path:t.join(":")}):null},_bindModuleChange:function(e,t){var i=t.moduleDescription.container[t.moduleDescription.property],r=t.boundTo;null==this._utils.resolvePath(r.path,r.storage)&&this._pathUtils.setValue(r.storage,r.path,null);var a=this._pathUtils.describe(r.storage,r.path);this.json.setValue(a.container,a.property,i)}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/SiteConfigHelper.js
//*******************
var e=require("../../Aria"),t=require("../../utils/Dom"),i=require("./PageEngineUtils"),r=require("../../utils/Array"),a=require("../../utils/Type");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.SiteConfigHelper",$constructor:function(e){this.siteConfig=e,this._contentProcessorsInstances={},i.addKeyAsProperty(this.siteConfig.commonModules,"refpath")},$destructor:function(){this.disposeContentProcessorsInstances()},$statics:{CONTAINER_ID_CANT_BE_BODY_ID:"The 'containerId' page engine config entry must not be the id of BODY element",MISSING_PROCESS_METHOD:"The processContent method is not implemented"},$prototype:{getRootDiv:function(){var i=this.getRootDivId(),r=t.getElementById(i);return r===e.$window.document.body?this.$logError(this.CONTAINER_ID_CANT_BE_BODY_ID):r||(r=e.$window.document.createElement("DIV"),r.id=i,e.$window.document.body.appendChild(r)),r},getRootDivId:function(){return this.siteConfig.containerId},getAppData:function(){return this.siteConfig.appData},getListOfContentProcessors:function(){var e=[];for(var t in this.siteConfig.contentProcessors)this.siteConfig.contentProcessors.hasOwnProperty(t)&&e.push(this.siteConfig.contentProcessors[t]);return e},getContentProcessorInstances:function(){var t={},i=a;for(var r in this.siteConfig.contentProcessors)if(this.siteConfig.contentProcessors.hasOwnProperty(r)){var s=e.getClassRef(this.siteConfig.contentProcessors[r]),n=i.isFunction(s)?new s:s;n.processContent?t[r]=n:this.$logError(this.MISSING_PROCESS_METHOD,this.siteConfig.contentProcessors[r])}return this._contentProcessorsInstances=t,t},disposeContentProcessorsInstances:function(){var t=a,i=this._contentProcessorsInstances;for(var r in i)if(i.hasOwnProperty(r)){var s=e.getClassRef(this.siteConfig.contentProcessors[r]);t.isFunction(s)&&i[r].$dispose()}},getCommonModulesDescription:function(e){var t=this.siteConfig.commonModules;if(!e)return r.extractValuesFromMap(t);var i,a=e.priority,s=e.refpaths,n=[];if(s){for(var o=0,l=s.length;l>o;o++)i=t[s[o]],!i||a&&a!=i.priority||n.push(i);return n}for(var c in t)t.hasOwnProperty(c)&&(i=t[c],a&&a!=i.priority||n.push(i));return n},getNavigationManagerClass:function(){var e=this.siteConfig.navigation;if(e){if("history"==e)return"aria.pageEngine.utils.HistoryManager";if("hash"==e)return"aria.pageEngine.utils.HashManager"}return null},getNavigationManager:function(e,t){var i=this.siteConfig.navigation;if(i){if("history"==i)return new aria.pageEngine.utils.HistoryManager(e,t);if("hash"==i)return new aria.pageEngine.utils.HashManager(e,t)}return null},getSiteCss:function(){return this.siteConfig.css||[]}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/PageConfigHelper.js
//*******************
var e=require("../../Aria"),t=require("./PageEngineUtils"),i=require("../../utils/Type"),r=require("../../utils/Array"),a=require("../../utils/Json");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.PageConfigHelper",$constructor:function(e){this._pageConfig=e,this._utils=t,this._pageModules=a.copy(this._pageConfig.pageComposition.modules)||{},this._utils.addKeyAsProperty(this._pageModules,"refpath")},$prototype:{getMenus:function(){var e=this._pageConfig.contents;return e?e.menus:null},getPageDependencies:function(e){var t={templates:[],classes:[],modules:{page:[],common:[]},css:[]},r=this._pageConfig.pageComposition,a=r.placeholders||{},s=i;e||(this._utils.addIfMissing(r.template,t.templates),r.css&&(t.css=r.css.slice(0)));for(var n in a)if(a.hasOwnProperty(n)){var o=a[n];s.isArray(o)||(o=[o]);for(var l=0;l<o.length;l+=1)this._addPlaceholderDependencies(o[l],t,e)}return t},_addPlaceholderDependencies:function(e,t,r){var a,s,n=this._pageModules,o=i;if(o.isObject(e)){var l=e.lazy;r&&!l||!r&&l||("module"in e&&(a=e.module,a.match(/^common:/)?this._utils.addIfMissing(a.replace(/^common:/,""),t.modules.common):(s=n[a],s&&(this._utils.addIfMissing(s.classpath,t.classes),this._utils.addIfMissing(a,t.modules.page)))),"template"in e&&this._utils.addIfMissing(e.template,t.templates),"css"in e&&this._utils.wiseConcat(t.css,e.css))}},getPageModulesDescriptions:function(e){var t,i,a,s=this._pageModules,n=[];if(e){for(t=0,i=e.length;i>t;t++)a=s[e[t]],a&&n.push(a);return n}return r.extractValuesFromMap(s)},getLazyPlaceholdersIds:function(){var e,t=[],r=i,a=this._pageConfig.pageComposition.placeholders||{};for(var s in a)if(a.hasOwnProperty(s)){e=!1;var n=a[s];r.isArray(n)||(n=[n]);for(var o=0;o<n.length;o+=1)n[o].lazy&&(e=!0);e&&t.push(s)}return t}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/PageEngine.js
//*******************
var e=require("../Aria"),t=require("../embed/IContentProvider"),i=require("./PageEngineInterface");require("./CfgBeans"),require("./SiteRootModule");var r=require("../templates/ModuleCtrlFactory"),a=require("../core/JsonValidator"),s=require("./utils/SiteConfigHelper"),n=require("./utils/PageConfigHelper"),o=require("../embed/PlaceholderManager"),l=require("../utils/Type");require("../utils/String");var c=require("./utils/PageEngineUtils"),u=require("../utils/CSSLoader"),h=require("../utils/Json"),p=require("../core/Browser"),d=require("../utils/Array"),f=require("../core/Timer");module.exports=e.classDefinition({$classpath:"aria.pageEngine.PageEngine",$implements:[t,i],$constructor:function(){this._config=null,this._pageProvider=null,this._navigationManager=null;var e=p;this._animationsDisabled=e.isOldIE&&e.majorVersion<10||e.isFirefox&&e.majorVersion<4,this._animationsManager=null,this._siteConfigHelper=null,this._rootModule=null,this._pageConfigs={},this._currentPageCSS=[],this._previousPageCSS=[],this.contentProcessors={},this.currentPageId=null,this._utils=c,this._wrapper=this.$interface("aria.pageEngine.PageEngineInterface"),this._isTemplateLoaded=!1,this._activeDiv=1,this._firstDiv=null,this._secondDiv=null,this._data={},this._modulesInPage=[],this._onPageDefinitionChangeListener={fn:this._onPageDefinitionChange,scope:this}},$destructor:function(){o.unregister(this),this._navigationManager&&this._navigationManager.$dispose(),this._isTemplateLoaded&&e.disposeTemplate(this._getContainer()),this._animationsManager&&this._animationsManager.$dispose(),this._firstDiv=null,this._secondDiv&&(this._secondDiv.parentNode.removeChild(this._secondDiv),this._secondDiv=null);var t=this._siteConfigHelper,i=this._pageConfigHelper,r=u;t&&(r.remove(t.getSiteCss()),t.$dispose()),i&&(i.$dispose(),i=null),r.remove(this._previousPageCSS),r.remove(this._currentPageCSS),this._modulesInPage=null,this._rootModule&&(this._rootModule.$dispose(),this._rootModule=null),this._pageProvider&&this._pageProvider.$removeListeners({pageDefinitionChange:this._onPageDefinitionChangeListener}),this._onPageDefinitionChangeListener=null},$statics:{SITE_CONFIG_NOT_AVAILABLE:"Unable to retrieve the site configuration",INVALID_SITE_CONFIGURATION:"The configuration object of the application is not valid",PAGE_NOT_AVAILABLE:"Unable to retrieve page %1",INVALID_PAGE_DEFINITION:"The page definition does not match the bean aria.pageEngine.CfgBeans.PageDefinition",MISSING_DEPENDENCIES:"Unable to download Page Engine dependencies",INVALID_ROOTMODULE_PARENT:"Custom root module controller should extend aria.pageEngine.SiteRootModule"},$prototype:{start:function(e){this._config=e,this._pageProvider=e.pageProvider,o.register(this),this._pageProvider.$addListeners({pageDefinitionChange:this._onPageDefinitionChangeListener}),this._pageProvider.loadSiteConfig({onsuccess:{fn:this._loadRootModule,scope:this},onfailure:this._getErrorCallbackConfig([this.SITE_CONFIG_NOT_AVAILABLE])})},_loadRootModule:function(t){var i=this.isConfigValid(t,"aria.pageEngine.CfgBeans.Site",this.INVALID_SITE_CONFIGURATION);if(i){var r=new s(t);this._siteConfigHelper=r;var a=r.getAppData();a.menus=a.menus||{};var n={appData:a,pageEngine:this._wrapper},o=this._config.rootModule;if(o){var l=o.classpath;o.initArgs&&h.inject(n,o.initArgs);var c=this;e.load({classes:[l],oncomplete:function(){return"aria.pageEngine.SiteRootModule"!==e.getClassRef(l).classDefinition.$extends?void c._errorCallback([c.INVALID_ROOTMODULE_PARENT]):void c._createModuleCtrl(o)},onerror:this._getErrorCallbackConfig([this.MISSING_DEPENDENCIES])})}else this._createModuleCtrl({classpath:"aria.pageEngine.SiteRootModule",initArgs:n})}},_createModuleCtrl:function(e){r.createModuleCtrl(e,{fn:this._loadSiteDependencies,scope:this})},_loadSiteDependencies:function(t){this._rootModule=t.moduleCtrlPrivate,this._data=this._rootModule.getData().storage;var i=this._siteConfigHelper;u.add(i.getSiteCss());var r=i.getListOfContentProcessors(),a=i.getNavigationManagerClass();a&&r.push(a),i.siteConfig.animations&&r.push("aria.pageEngine.utils.AnimationsManager");var s=i.getCommonModulesDescription({priority:1});this._utils.wiseConcat(r,this._utils.extractPropertyFromArrayElements(s,"classpath")),e.load({classes:r,oncomplete:{fn:this._loadGlobalModules,scope:this,args:s},onerror:this._getErrorCallbackConfig([this.MISSING_DEPENDENCIES])})},_loadGlobalModules:function(e){this._rootModule.loadModules(null,{page:[],common:e},{fn:this._onSiteReady,scope:this})},_onSiteReady:function(){var e=this._siteConfigHelper;this.contentProcessors=e.getContentProcessorInstances(),this._firstDiv=e.getRootDiv(),!this._animationsDisabled&&e.siteConfig.animations&&(this._animationsManager=new aria.pageEngine.utils.AnimationsManager,this._secondDiv=this._animationsManager.createHiddenDiv(this._firstDiv)),this._navigationManager=e.getNavigationManager({fn:"navigate",scope:this},e.siteConfig.storage),this.navigate({url:this._navigationManager?this._navigationManager.getUrl():null,pageId:this._navigationManager?this._navigationManager.getPageId():null,replace:!0},this._config.oncomplete)},navigate:function(e,t){var i=e.pageId,r=e.forceReload;!r&&i&&i==this.currentPageId?(this.$callback(t),this._navigationManager&&(this._navigationManager.update(e),h.setValue(this._data,"pageInfo",e))):(this._previousPageCSS=this._currentPageCSS,this._currentPageCSS=[],this._pageProvider.loadPageDefinition(e,{onsuccess:{fn:this._getPageDependencies,scope:this,args:{pageRequest:e,cb:t}},onfailure:this._getErrorCallbackConfig([this.PAGE_NOT_AVAILABLE,i])}))},_getPageDependencies:function(e,t){var i=this.isConfigValid(e,"aria.pageEngine.CfgBeans.PageDefinition",this.INVALID_PAGE_DEFINITION);if(!i)return void this.$callback(t.cb);var r=this._getPageConfigHelper(e);h.inject(r.getMenus(),this._siteConfigHelper.getAppData().menus),this._pageConfigHelper=r,this._lazyContent=!0,this._loadPageDependencies({lazy:!1,pageId:e.pageId,cb:{fn:this._displayPage,scope:this,args:{cb:t.cb,pageConfig:e,pageRequest:t.pageRequest}}})},_getPageConfigHelper:function(e){return new n(e)},_loadPageDependencies:function(t){if(!this._pageConfigHelper)return void this.$callback(t.cb);var i=this._pageConfigHelper.getPageDependencies(t.lazy),r=this._siteConfigHelper.getCommonModulesDescription({priority:2,refpaths:i.modules.common});this._utils.wiseConcat(i.classes,this._utils.extractPropertyFromArrayElements(r,"classpath"));var a=this._pageConfigHelper.getPageModulesDescriptions(i.modules.page);this._currentPageCSS=this._currentPageCSS.concat(i.css),u.add(i.css),delete i.css,i.oncomplete={scope:this,fn:this._loadPageModules,args:{pageId:t.pageId,cb:t.cb,subModules:{common:r,page:a}}},i.onerror=this._getErrorCallbackConfig([this.MISSING_DEPENDENCIES]),e.load(i)},_loadPageModules:function(e){var t=e.subModules;this._rootModule.loadModules(e.pageId,t,e.cb)},isConfigValid:function(e,t,i){try{a.normalize({json:e,beanName:t},!0)}catch(r){return this._utils.logMultipleErrors(i,r.errors,this),this._config.onerror&&this.$callback(this._config.onerror,[i]),!1}return!0},_displayPage:function(t){if(!this._pageConfigHelper)return void this.$callback(t.cb);var i=t.pageConfig,r=i.pageComposition,a=i.pageId;this.$raiseEvent({name:"beforePageTransition",from:this.currentPageId,to:a}),this.currentPageId=a,this._pageConfigs[a]=i;var s=t.pageRequest;s.url=i.url,s.pageId=i.pageId,s.title=i.title;var n=h;n.setValue(this._data,"pageData",r.pageData),n.setValue(this._data,"pageInfo",s);var o={classpath:r.template,div:this._getContainer(!i.animation),moduleCtrl:this._rootModule};this._modulesInPage=[],o.div==this._getContainer()&&this._isTemplateLoaded&&e.disposeTemplate(this._getContainer()),e.loadTemplate(o,{fn:this._afterTemplateLoaded,scope:this,args:{pageConfig:i,cb:t.cb,div:o.div,pageRequest:s}})},_afterTemplateLoaded:function(e,t){this._navigationManager&&this._navigationManager.update(t.pageRequest);var i=p;i.isOldIE&&i.majorVersion<8&&f.addCallback({fn:function(){t.div.style.zoom=0,t.div.style.zoom=1,t.div=null},scope:this,delay:0}),this._isTemplateLoaded=!0,this._animationsManager&&t.pageConfig.animation?(this._animationsManager.$on({animationend:{fn:this._pageTransitionComplete,args:t},scope:this}),this._animationsManager.startPageTransition(this._getContainer(!1),this._getContainer(),t.pageConfig.animation)):this._finishDisplay(t)},_pageTransitionComplete:function(t,i){this._animationsManager.$removeListeners({animationend:this._pageTransitionComplete,scope:this}),this._activeDiv=(this._activeDiv+1)%2,e.disposeTemplate(this._getContainer(!1)),this._finishDisplay(i)},_finishDisplay:function(e){u.remove(this._previousPageCSS),this.$raiseEvent({name:"pageReady",pageId:e.pageConfig.pageId}),e.cb&&this.$callback(e.cb),this._loadPageDependencies({lazy:!0,pageId:e.pageConfig.pageId,cb:{fn:this._afterLazyDependenciesLoad,scope:this}})},_getContainer:function(e){return this._animationsManager?(e=!(e===!1),e?0===this._activeDiv?this._firstDiv:this._secondDiv:1===this._activeDiv?this._firstDiv:this._secondDiv):this._firstDiv},_afterLazyDependenciesLoad:function(){if(this._pageConfigHelper){var e=this._pageConfigHelper.getLazyPlaceholdersIds();this._lazyContent=!1,this.$raiseEvent({name:"contentChange",contentPaths:e}),this._pageConfigHelper.$dispose()}},getContent:function(e){var t,i=l,r=this._pageConfigs[this.currentPageId];if(r){var a=r.pageComposition.placeholders,s=a[e]||[];t=[];var n;i.isArray(s)||(s=[s]);for(var o=0,c=s.length;c>o;o++){var u=s[o];i.isObject(u)?this._lazyContent&&u.lazy?t.push({loading:!0,width:u.lazy.width||null,height:u.lazy.height||null,color:u.lazy.color||null,innerHTML:u.lazy.innerHTML||null}):u.template?t.push(this._getTemplateCfg(u,r)):u.contentId&&(n=this._getPlaceholderContents(r,u.contentId),t=t.concat(n)):t.push(u)}}return t},_getTemplateCfg:function(e,t){var i={classpath:e.template},r=e.args||[],a={};if(e.contentId&&(a.contents=this._getPlaceholderContents(t,e.contentId)),r.push(a),i.args=r,e.module){var s=this._rootModule.getPageModule(this.currentPageId,e.module);i.moduleCtrl=s,this._modulesInPage.push(s)}return i},_getPlaceholderContents:function(e,t){var i=[],r=e.contents.placeholderContents?e.contents.placeholderContents[t]:null;if(!r)return i;l.isArray(r)||(r=[r]);for(var a=0,s=r.length;s>a;a++)i=i.concat(this.processContent(r[a]));return i},processContent:function(e){var t=e.contentType;return t&&t in this.contentProcessors?this.processContent(this.contentProcessors[t].processContent(e)):e.value||""},_errorCallback:function(e){var t=this._config;this.$logError.apply(this,e),t.onerror&&this.$callback(t.onerror,e)},_getErrorCallbackConfig:function(e){return{fn:this._errorCallback,scope:this,args:e,resIndex:-1}},_onPageDefinitionChange:function(e){var t=e.pageId;this.currentPageId==t&&(this._rootModule.unloadPageModules(t),this.navigate({pageId:t,url:this._navigationManager?this._navigationManager.getUrl():null,forceReload:!0}))},getData:function(){return this._data},getPageProvider:function(){return this._pageProvider},getServices:function(){return this._rootModule.services},isModuleInPage:function(e){return d.contains(this._modulesInPage,e.$publicInterface())}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/contentProcessors/MarkdownProcessor.js
//*******************
var e=require("../../Aria"),t=require("../../core/JsObject");!function(){var i={};i.converter=function(){var e,t,i,r=0;this.makeHtml=function(r){return e=new Array,t=new Array,i=new Array,r=r.replace(/~/g,"~T"),r=r.replace(/\$/g,"~D"),r=r.replace(/\r\n/g,"\n"),r=r.replace(/\r/g,"\n"),r="\n\n"+r+"\n\n",r=D(r),r=r.replace(/^[ \t]+$/gm,""),r=n(r),r=s(r),r=l(r),r=S(r),r=r.replace(/~D/g,"$$"),r=r.replace(/~T/g,"~")};var a,s=function(i){var i=i.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(i,r,a,s,n){return r=r.toLowerCase(),e[r]=A(a),s?s+n:(n&&(t[r]=n.replace(/"/g,"&quot;")),"")});return i},n=function(e){e=e.replace(/\n/g,"\n\n");return e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,o),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,o),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,o),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,o),e=e.replace(/\n\n/g,"\n")},o=function(e,t){var r=t;return r=r.replace(/\n\n/g,"\n"),r=r.replace(/^\n/,""),r=r.replace(/\n+$/g,""),r="\n\n~K"+(i.push(r)-1)+"K\n\n"},l=function(e){e=m(e);var t=v("<hr />");return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,t),e=e.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,t),e=g(e),e=_(e),e=C(e),e=n(e),e=b(e)},c=function(e){return e=y(e),e=u(e),e=T(e),e=d(e),e=h(e),e=w(e),e=A(e),e=E(e),e=e.replace(/  +\n/g," <br />\n")},u=function(e){var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=M(t,"\\`*_")})},h=function(e){return e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),e=e.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p),e=e.replace(/(\[([^\[\]]+)\])()()()()()/g,p)},p=function(i,r,a,s,n,o,l,c){void 0==c&&(c="");var u=r,h=a,p=s.toLowerCase(),d=n,f=c;if(""==d)if(""==p&&(p=h.toLowerCase().replace(/ ?\n/g," ")),d="#"+p,void 0!=e[p])d=e[p],void 0!=t[p]&&(f=t[p]);else{if(!(u.search(/\(\s*\)$/m)>-1))return u;d=""}d=M(d,"*_");var m='<a href="'+d+'"';return""!=f&&(f=f.replace(/"/g,"&quot;"),f=M(f,"*_"),m+=' title="'+f+'"'),m+=">"+h+"</a>"},d=function(e){return e=e.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,f),e=e.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,f)},f=function(i,r,a,s,n,o,l,c){var u=r,h=a,p=s.toLowerCase(),d=n,f=c;if(f||(f=""),""==d){if(""==p&&(p=h.toLowerCase().replace(/ ?\n/g," ")),d="#"+p,void 0==e[p])return u;d=e[p],void 0!=t[p]&&(f=t[p])}h=h.replace(/"/g,"&quot;"),d=M(d,"*_");var m='<img src="'+d+'" alt="'+h+'"';return f=f.replace(/"/g,"&quot;"),f=M(f,"*_"),m+=' title="'+f+'"',m+=" />"},m=function(e){return e=e.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(e,t){return v("<h1>"+c(t)+"</h1>")}),e=e.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(e,t){return v("<h2>"+c(t)+"</h2>")}),e=e.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(e,t,i){var r=t.length;return v("<h"+r+">"+c(i)+"</h"+r+">")})},g=function(e){e+="~0";var t=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return r?e=e.replace(t,function(e,t,i){var r=t,s=i.search(/[*+-]/g)>-1?"ul":"ol";r=r.replace(/\n{2,}/g,"\n\n\n");var n=a(r);return n=n.replace(/\s+$/,""),n="<"+s+">"+n+"</"+s+">\n"}):(t=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,e=e.replace(t,function(e,t,i,r){var s=t,n=i,o=r.search(/[*+-]/g)>-1?"ul":"ol",n=n.replace(/\n{2,}/g,"\n\n\n"),l=a(n);return l=s+"<"+o+">\n"+l+"</"+o+">\n"})),e=e.replace(/~0/,"")};a=function(e){return r++,e=e.replace(/\n{2,}$/,"\n"),e+="~0",e=e.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(e,t,i,r,a){var s=a,n=t;return n||s.search(/\n{2,}/)>-1?s=l(x(s)):(s=g(x(s)),s=s.replace(/\n$/,""),s=c(s)),"<li>"+s+"</li>\n"}),e=e.replace(/~0/g,""),r--,e};var _=function(e){return e+="~0",e=e.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(e,t,i){var r=t,a=i;return r=$(x(r)),r=D(r),r=r.replace(/^\n+/g,""),r=r.replace(/\n+$/g,""),r="<pre><code>"+r+"\n</code></pre>",v(r)+a}),e=e.replace(/~0/,"")},v=function(e){return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(i.push(e)-1)+"K\n\n"},y=function(e){return e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,i,r){var a=r;return a=a.replace(/^([ \t]*)/g,""),a=a.replace(/[ \t]*$/g,""),a=$(a),t+"<code>"+a+"</code>"})},$=function(e){return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=M(e,"*_{}[]\\",!1)},E=function(e){return e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},C=function(e){return e=e.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,t){var i=t;return i=i.replace(/^[ \t]*>[ \t]?/gm,"~0"),i=i.replace(/~0/g,""),i=i.replace(/^[ \t]+$/gm,""),i=l(i),i=i.replace(/(^|\n)/g,"$1  "),i=i.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var i=t;return i=i.replace(/^  /gm,"~0"),i=i.replace(/~0/g,"")}),v("<blockquote>\n"+i+"\n</blockquote>")})},b=function(e){e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var t=e.split(/\n{2,}/g),r=new Array,a=t.length,s=0;a>s;s++){var n=t[s];n.search(/~K(\d+)K/g)>=0?r.push(n):n.search(/\S/)>=0&&(n=c(n),n=n.replace(/^([ \t]*)/g,"<p>"),n+="</p>",r.push(n))}a=r.length;for(var s=0;a>s;s++)for(;r[s].search(/~K(\d+)K/)>=0;){var o=i[RegExp.$1];o=o.replace(/\$/g,"$$$$"),r[s]=r[s].replace(/~K\d+K/,o)}return r.join("\n\n")},A=function(e){return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},T=function(e){return e=e.replace(/\\(\\)/g,R),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,R)},w=function(e){return e=e.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),e=e.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(e,t){return I(S(t))})},I=function(e){function t(e){var t="0123456789ABCDEF",i=e.charCodeAt(0);return t.charAt(i>>4)+t.charAt(15&i)}var i=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+t(e)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"==e)e=i[Math.floor(2*Math.random())](e);else if(":"!=e){var t=Math.random();e=t>.9?i[2](e):t>.45?i[1](e):i[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')},S=function(e){return e=e.replace(/~E(\d+)E/g,function(e,t){var i=parseInt(t);return String.fromCharCode(i)})},x=function(e){return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")},D=function(e){return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var i=t,r=4-i.length%4,a=0;r>a;a++)i+=" ";return i}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")},M=function(e,t,i){var r="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";i&&(r="\\\\"+r);var a=new RegExp(r,"g");return e=e.replace(a,R)},R=function(e,t){var i=t.charCodeAt(0);return"~E"+i+"E"}},module.exports=e.classDefinition({$classpath:"aria.pageEngine.contentProcessors.MarkdownProcessor",$extends:t,$singleton:!0,$constructor:function(){this.__converter=new i.converter},$destructor:function(){this._converter=null},$prototype:{processContent:function(e){var t={value:this.__converter.makeHtml(e.value),contentType:"text/html"};return t}}})}();
//*******************
//LOGICAL-PATH:aria/pageEngine/pageProviders/PageProviderInterface.js
//*******************
var e=require("../../Aria");module.exports=e.interfaceDefinition({$classpath:"aria.pageEngine.pageProviders.PageProviderInterface",$events:{pageDefinitionChange:""},$interface:{loadSiteConfig:function(){},loadPageDefinition:function(){}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/pageProviders/BasePageProvider.js
//*******************
var e=require("../../Aria"),t=require("./PageProviderInterface"),i=require("../../core/DownloadMgr"),r=require("../../utils/Json");module.exports=e.classDefinition({$classpath:"aria.pageEngine.pageProviders.BasePageProvider",$implements:[t],$constructor:function(e){this.__config=e,this.__basePageUrl=null,"cache"in e||(e.cache=!0),this.__urlMap={pageIdToUrl:{},urlToPageId:{}}},$prototype:{loadSiteConfig:function(e){this.__sendRequest(this.__config.siteConfigLocation,{callback:e},"site")},loadPageDefinition:function(e,t){e=e||{};var r=this.__getPageId(e);e.pageId=r,this.__updateUrlMap(e),this.__basePageUrl=this.__basePageUrl||(this.__config.pageBaseLocation+"fake.json").replace(/fake\.json$/,"");var a=this.__basePageUrl+r+".json";this.__config.cache||i.clearFile(a),this.__sendRequest(a,{pageRequest:e,callback:t},"page")},processSiteConfig:function(e){return e},processPageDefinition:function(e){return e},__sendRequest:function(e,t,r){i.loadFile(e,{fn:this.__onRawFileReceive,scope:this,args:{fn:"page"==r?this.__onPageSuccess:this.__onSiteSuccess,scope:this,args:t}})},__onRawFileReceive:function(e,t){if(e.downloadFailed)this.__onFailure(e,t.args);else{var a=i.getFileContent(e.logicalPaths[0]),s=r.load(a);s?this.$callback(t,s):this.__onFailure(e,t.args)}},__onSiteSuccess:function(e,t){var i=this.processSiteConfig(e);this.$callback(t.callback.onsuccess,i)},__onPageSuccess:function(e,t){var i=t.callback,r=t.pageRequest;this.__updateUrlMap(e);var a=this.__getUrl(r);e.url=a,this.__updateUrlMap(e),this.$callback(i.onsuccess,this.processPageDefinition(e))},__onFailure:function(e,t){this.$callback(t.callback.onfailure)},__updateUrlMap:function(e){var t=e.pageId,i=e.url,r=this.__urlMap;if(t&&i){r.pageIdToUrl[t]=i,r.urlToPageId[i]=t;var a=i.replace(/\/$/,"");r.urlToPageId[a]=t}},__getPageId:function(e){var t=this.__urlMap.urlToPageId,i=e.pageId,r=e.url;if(i)return i;if(r){var a=t[r]||t[r+"/"]||t[r.replace(/\/$/,"")];if(a)return a}return this.__config.homePageId},__getUrl:function(e){var t=this.__urlMap.pageIdToUrl,i=e.pageId,r=e.url;return r?r:i&&t[i]?t[i]:"/"+i}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/pageProviders/BasePageProviderBeans.js
//*******************
var e=require("../../Aria"),t=require("../../core/JsonTypes");module.exports=e.beanDefinitions({$package:"aria.pageEngine.pageProviders.BasePageProviderBeans",$namespaces:{json:t},$beans:{Config:{$type:"json:Object",$properties:{siteConfigLocation:{$type:"json:String",$mandatory:!0},pageBaseLocation:{$type:"json:String",$mandatory:!0},cache:{$type:"json:Boolean",$default:!0},homePageId:{$type:"json:String",$mandatory:!0}}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/AnimationsManager.js
//*******************
var e=require("../../Aria"),t=require("../../utils/css/Animations");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.AnimationsManager",$constructor:function(){this._syncCfg={waiting:0,toDispose:[]}},$destructor:function(){this._syncCfg=null},$events:{animationend:""},$prototype:{createHiddenDiv:function(e){var t=e.cloneNode(!0);return t.setAttribute("id",""),t.className=t.className+" xanimation-element",t.innerHTML="",e.parentNode.insertBefore(t,e.nextSibling),t},_start:function(e,i){var r=new t;this._syncCfg.toDispose.push(r),r.$on({animationend:{fn:this._animationComplete},scope:this}),e.reverse=i.reverse,r.start(i.name,e)},startPageTransition:function(e,t,i){if(i.animateOut&&i.animateIn&&i.animateIn==i.animateOut){var r={from:t,to:e};i.type&&(r.type=i.type),this._syncCfg.waiting+=1,this._start(r,this._mappingAnimations(i.animateOut))}else{if(i.animateOut){var r={from:t};i.type&&(r.type=i.type),this._syncCfg.waiting+=1,this._start(r,this._mappingAnimations(i.animateOut))}else-1===t.className.indexOf("xanimation-element")&&(t.className=t.className+" xanimation-element");if(i.animateIn){var r={to:e};i.type&&(r.type=i.type),this._syncCfg.waiting+=1,this._start(r,this._mappingAnimations(i.animateIn))}}},_mappingAnimations:function(e){var t,i;switch(e){case"slide left":t="slide",i=!1;break;case"slide right":t="slide",i=!0;break;case"slide up":t="slideup",i=!1;break;case"slide down":t="slidedown",i=!1;break;case"fade":t="fade",i=!1;break;case"fade reverse":t="fade",i=!0;break;case"pop":t="pop",i=!1;break;case"pop reverse":t="pop",i=!0;break;case"flip":t="flip",i=!1;break;case"flip reverse":t="flip",i=!0;break;default:t=e,i=!1}return{name:t,reverse:i}},_animationComplete:function(){if(this._syncCfg.waiting-=1,0===this._syncCfg.waiting){for(var e,t=this._syncCfg.toDispose,i=t.length-1;i>=0;i--)e=t[i],e.$unregisterListeners(),e.$dispose(),t.splice(t.length-1,1);this.$raiseEvent("animationend")}}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/BaseNavigationManager.js
//*******************
var e=require("../../Aria"),t=require("../../storage/LocalStorage"),i=require("../../utils/Event"),r=require("../../utils/Type");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.BaseNavigationManager",$statics:{STORAGE_KEY_PREFIX:"at_pe_navigation_cache",EXPIRATION_TIME:86400},$constructor:function(a,s){s=s||{},this._navigate=a||null,s.active?(this._storageKey=this.STORAGE_KEY_PREFIX+s.suffix,this._expiresAfter=r.isNumber(s.expiresAfter)?s.expiresAfter:this.EXPIRATION_TIME,this._storage=new t,this._saveCacheCB={fn:this._saveCache,scope:this},i.addListener(e.$window,"unload",this._saveCacheCB),this._cache=this._storage.getItem(this._storageKey)||{},this._removeOldCache()):(this._storage=null,this._cache={})},$destructor:function(){this._navigate=null,this._storage&&this._saveCache(),this._cache=null},$prototype:{getPageId:function(){var e=this._cache[this.getUrl()];return e?e.id:null},_saveCache:function(){this._storage&&(this._removeOldCache(),this._storage.setItem(this._storageKey,this._cache),this._storage.$dispose(),this._storage=null),i.removeListener(e.$window,"unload",this._saveCacheCB)},_removeOldCache:function(){var e=this._cache,t=(new Date).getTime()-1e3*this._expiresAfter;for(var i in e)e.hasOwnProperty(i)&&e[i].age<t&&delete e[i]},_addInCache:function(e,t){this._cache[e]={id:t,age:(new Date).getTime()}},getCache:function(){return this._cache}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/HashManager.js
//*******************
var e=require("../../Aria"),t=require("../../utils/HashManager"),i=require("../../utils/Type"),r=require("./BaseNavigationManager");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.HashManager",$extends:r,$constructor:function(){this.$BaseNavigationManager.constructor.apply(this,arguments),this._hashManager=t,this._onHashChangeCallback={fn:this._onHashChange,scope:this},this._lastPageId=null,this._hashManager.addCallback(this._onHashChangeCallback)},$destructor:function(){this._hashManager.removeCallback(this._onHashChangeCallback),this._onHashChangeCallback=null,this._hashManager=null,this.$BaseNavigationManager.$destructor.call(this)},$prototype:{_onHashChange:function(){var e=this.getUrl(),t=this._cache[e]?this._cache[e].id:null;t?this._navigate&&this.$callback(this._navigate,{pageId:t,url:e}):this._addInCache(e,this._lastPageId)},update:function(t){var r=t.url,a=t.title,s=t.pageId,n=i;this._lastPageId=s,n.isString(r)&&(this._addInCache(r,s),this.getUrl()!=r&&this._hashManager.setHash(r)),n.isString(a)&&(e.$window.document.title=a)},getUrl:function(){return this._hashManager.getHashString()}}});
//*******************
//LOGICAL-PATH:aria/pageEngine/utils/HistoryManager.js
//*******************
var e=require("../../Aria"),t=require("../../utils/History"),i=require("../../utils/Type"),r=require("./BaseNavigationManager");module.exports=e.classDefinition({$classpath:"aria.pageEngine.utils.HistoryManager",$extends:r,$constructor:function(){this.$BaseNavigationManager.constructor.apply(this,arguments),this._history=t,this._onPopStateCallback={fn:this._onPopState,scope:this},this._history.$addListeners({popstate:this._onPopStateCallback}),this._poppedState=!1},$destructor:function(){this._history.$removeListeners({popstate:this._onPopStateCallback}),this._onPopStateCallback=null,this._history=null,this.$BaseNavigationManager.$destructor.call(this)},$prototype:{_onPopState:function(){var e=this.getUrl(),t=this._cache[e]?this._cache[e].id:null;t&&this._navigate&&(this._poppedState=!0,this.$callback(this._navigate,{pageId:t,url:e,title:this.getTitle()}))},update:function(e){var t=e.url;i.isString(t)&&(this._addInCache(t,e.pageId),this._poppedState||(e.replace?this._history.replaceState(e.data,e.title,t):this._history.pushState(e.data,e.title,t)),this._poppedState=!1)},getUrl:function(){var t=this._history.getUrl();return t==e.$window.location.href?"":t},getTitle:function(){return this._history.getTitle()}}});